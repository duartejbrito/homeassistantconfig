### Device Tracking ###
arrive_home:
  alias: Arrive Home
  sequence:
  - data: {}
    service: script.turn_on_lights_living_room
  - service: script.turn_on_presence_lights
leave_home:
  alias: Leave Home
  sequence:
  - data: {}
    service: script.turn_off_all_lights
  - service: script.turn_off_all_media

### Lights ###
turn_off_all_lights:
  alias: Turn Off All Lights
  sequence:
  - service: light.turn_off
    data_template:
      entity_id: >
        {% for item in dict(states.light|groupby("state"))["on"] -%}{{ item.entity_id | lower }}{%- if not loop.last -%},{%- endif -%}{%- endfor %}
    
turn_on_tradfri_light:
  alias: Turn On Tradfri Light
  sequence:
  - service: light.turn_on
    data_template:
      brightness_pct: '{{ brightness_pct|default(100) }}'
      transition: '{{ transition|default(1) }}'
      hs_color:
      - 29.812
      - 65.252
      entity_id: >
        {% for item in entity_id -%}{{ item | lower }}{%- if not loop.last -%},{%- endif -%}{%- endfor %}

### Living Room Lights ###
turn_on_lights_living_room:
  alias: Turn On Lights Living Room
  sequence:
  - alias: 'Tradfri'
    service: script.turn_on_tradfri_light
    data_template:
      brightness_pct: '{{ brightness_pct|default(100) }}'
      transition: '{{ transition|default(1) }}'
      entity_id:
      - light.sala
  - alias: 'Yeelight'
    data_template:
      brightness_pct: '{{ brightness_pct|default(100) }}'
      transition: '{{ transition|default(1) }}'
      color_temp: 357
      entity_id:
      - light.yeelight_color_bulb
    service: light.turn_on
turn_off_lights_living_room:
  alias: Turn Off Lights Living Room
  sequence:
  - data_template:
      transition: '{{ transition|default(1) }}'
      entity_id:
      - light.sala
      - light.yeelight_color_bulb
    service: light.turn_off
movie_time:
  alias: Movie Time
  sequence:
  - alias: ''
    data:
      brightness_pct: 20
    service: script.turn_on_lights_living_room

### Presence Lights ###
turn_on_presence_lights:
  alias: Turn On Presence Lights
  sequence:
  - data:
      entity_id: light.gateway_light_7c49eb193581
      brightness: 3
    service: light.turn_on
turn_off_presence_lights:
  alias: Turn Off Presence Lights
  sequence:
  - data:
      entity_id: light.gateway_light_7c49eb193581
    service: light.turn_off

### Medias ###
turn_off_all_media:
  alias: Turn Off All Media
  sequence:
  - data:
      entity_id: media_player.samsung_tv_remote
    service: media_player.turn_off

### Living room heating system ###
check_living_room_heating_system:
  alias: Check Living Room Heating System
  sequence:
  - service_template: "{% if (is_state('input_boolean.living_room_heating_system', 'on')) and (states('sensor.temperature_158d0002786e71') | float < states('input_number.living_room_heating_system_temperature') | float) %}switch.turn_on{% else %}switch.turn_off{% endif %}"
    entity_id: switch.dlink_smart_plug_w215

### Notifies ###
notify_slack:
  alias: Notify Slack
  sequence:
  - service: notify.hassiobot
    data_template:
      message: "{{ message }}"
notify_zanzito:
  alias: Notify Zanzito
  sequence:
  - service: mqtt.publish
    data_template:
      topic: "zanzito/{{ entity_id.split('.')[-1] }}/notification"
      payload: '{{ message }}'
      qos: 1
      retain: 0
notify_lovelace:
  alias: Notify Lovelace
  sequence:
  - service: tts.google_say
    entity_id: media_player.lovelace_player_pc
    data_template:
      message: '{{ message }}'
      language: '{{ language|default("pt") }}'
      cache: false